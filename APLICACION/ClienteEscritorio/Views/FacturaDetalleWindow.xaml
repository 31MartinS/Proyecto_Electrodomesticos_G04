<Window x:Class="ClienteEscritorio.Views.FacturaDetalleWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:ClienteEscritorio.Converters"
        Title="Detalle de Factura" 
        Height="700" 
        Width="950"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        Loaded="Window_Loaded">
    <Window.Resources>
        <converters:ImageUrlConverter x:Key="ImageUrlConverter"/>
    </Window.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="30" MaxWidth="900">
            
            <!-- Información de la Factura -->
            <Border BorderBrush="#4A90E2" 
                    BorderThickness="2" 
                    CornerRadius="10" 
                    Padding="20"
                    Background="White"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Información de la Factura" 
                               FontSize="20" 
                               FontWeight="Bold"
                               Margin="0,0,0,15"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Número:" FontWeight="Bold" Margin="0,5"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TxtNumero" Margin="0,5"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Fecha:" FontWeight="Bold" Margin="0,5"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" x:Name="TxtFecha" Margin="0,5"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Cliente:" FontWeight="Bold" Margin="0,5"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" x:Name="TxtCliente" Margin="0,5"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Forma de Pago:" FontWeight="Bold" Margin="0,5"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" x:Name="TxtFormaPago" Margin="0,5"/>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Productos -->
            <Border BorderBrush="#D9D9D9" 
                    BorderThickness="2" 
                    CornerRadius="10" 
                    Padding="20"
                    Background="White"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Productos Comprados" 
                               FontSize="18" 
                               FontWeight="Bold"
                               Margin="0,0,0,15"/>
                    <DataGrid x:Name="DgProductos"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              GridLinesVisibility="None"
                              Background="Transparent"
                              BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Imagen" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Image Source="{Binding Producto.ImageUrl, Converter={StaticResource ImageUrlConverter}}" 
                                               Width="50" 
                                               Height="50"
                                               Margin="5"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Producto" Binding="{Binding Producto.Nombre}" Width="*"/>
                            <DataGridTextColumn Header="Cantidad" Binding="{Binding Cantidad}" Width="80"/>
                            <DataGridTextColumn Header="Precio Unit." Binding="{Binding PrecioUnitario, StringFormat=C2}" Width="120"/>
                            <DataGridTextColumn Header="Total" Binding="{Binding TotalLinea, StringFormat=C2}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>

            <!-- Totales -->
            <Border BorderBrush="{StaticResource GreenButtonBrush}" 
                    BorderThickness="2" 
                    CornerRadius="10" 
                    Padding="20"
                    Background="White"
                    Margin="0,0,0,20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Subtotal:" FontSize="16" Margin="0,5"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TxtSubtotal" FontSize="16" FontWeight="Bold" Margin="0,5"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" x:Name="LblDescuento" Text="Descuento (33%):" FontSize="16" Margin="0,5"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="TxtDescuento" FontSize="16" FontWeight="Bold" Foreground="#F46A6A" Margin="0,5"/>

                    <Separator Grid.Row="2" Grid.ColumnSpan="2" Margin="0,10"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="TOTAL:" FontSize="22" FontWeight="Bold" Margin="0,5"/>
                    <TextBlock Grid.Row="3" Grid.Column="1" x:Name="TxtTotal" FontSize="22" FontWeight="Bold" Foreground="#4A90E2" Margin="0,5"/>
                </Grid>
            </Border>

            <!-- Tabla de Amortización -->
            <Border x:Name="BorderAmortizacion" 
                    BorderBrush="#FFD700" 
                    BorderThickness="2" 
                    CornerRadius="10" 
                    Padding="20"
                    Background="White"
                    Margin="0,0,0,20"
                    Visibility="Collapsed">
                <StackPanel>
                    <TextBlock Text="Tabla de Amortización" 
                               FontSize="18" 
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,15"/>
                    <DataGrid x:Name="DgAmortizacion"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              GridLinesVisibility="Horizontal"
                              Background="Transparent"
                              BorderThickness="0"
                              MaxHeight="300">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Cuota" Binding="{Binding NumeroCuota}" Width="60"/>
                            <DataGridTextColumn Header="Fecha Vencimiento" Binding="{Binding FechaVencimiento, StringFormat='dd/MM/yyyy'}" Width="130"/>
                            <DataGridTextColumn Header="Valor Cuota" Binding="{Binding ValorCuota, StringFormat=C2}" Width="110"/>
                            <DataGridTextColumn Header="Interés" Binding="{Binding InteresPagado, StringFormat=C2}" Width="110"/>
                            <DataGridTextColumn Header="Capital" Binding="{Binding CapitalPagado, StringFormat=C2}" Width="110"/>
                            <DataGridTextColumn Header="Saldo" Binding="{Binding SaldoRestante, StringFormat=C2}" Width="110"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>

            <!-- Botón Volver -->
            <Button Content="VOLVER" 
                    Style="{StaticResource PillButton}"
                    Background="{StaticResource GrayButtonBrush}"
                    Width="200"
                    Height="45"
                    HorizontalAlignment="Center"
                    Click="BtnVolver_Click"/>

        </StackPanel>
    </ScrollViewer>
</Window>
